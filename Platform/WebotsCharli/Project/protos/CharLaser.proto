#############################################
# CHARLI webots prototype file 
# Originally from VT 
# Converted and augmented by SJ
# Add laser: Steve
# 2012/3
#############################################

PROTO CharLaser [
  field SFVec3f    translation 0 1 0
  field SFRotation rotation 0 1 0 0
  field SFString   controller "void"
  field SFString   controllerArgs ""
  field SFBool     synchronization TRUE
  field SFString   name "CharLaser"
  field SFInt32    channel 0
#  field SFFloat    servoForce1 0.650000 #in Nm unit
#  field SFFloat    servoVelocity1 100
#  field SFFloat    servoForce2 65 #in Nm unit
#  field SFFloat    servoVelocity2 100
#  field SFFloat    servoP 15
]
{

Supervisor {
  translation IS translation
  rotation IS rotation
  controller IS controller
  controllerArgs IS controllerArgs
  synchronization IS synchronization
  name IS name
  children [
    DEF HipGroup Group {
      children [
        Shape {
	  appearance Appearance {
            material DEF DMetalMaterial Material { # New body material
              diffuseColor 0.7 0.7 0.7
              specularColor 0.401201 0.401201 0.401201
            }
          }
          geometry Box {
          size 0.186 0.022 0.069
          }
        }
      ]
    }
    DEF R_Hip_Yaw Servo {
      translation -0.07 -0.049 -0.0245
      children [
        DEF R_Hip_Roll Servo {
          rotation 0 0 1 0
          children [
            DEF R_Hip_Pitch Servo {
              rotation 1 0 0 0
              children [
                DEF Thigh Transform {
                  translation 0 -0.175 0
                  children [
                    Shape {
                      geometry Box {
                        size 0.016 0.3 0.0535
                      }
                    }
                  ]
                }
                DEF R_Knee_Pitch Servo {
                  translation 0 -0.35 0
                  rotation 1 0 0 0
                  children [
                    DEF R_Ankle_Pitch Servo {
                      translation 0 -0.35 0
                      rotation 1 0 0 0
                      children [
                        DEF R_Ankle_Roll Servo {
                          rotation 0 0 1 0
                          children [
                            DEF Foot Transform {
                              translation -0.0075 -0.071 0.03
                              children [
                                DEF Foot Shape {
                                  geometry Box {
                                    size 0.145 0.008 0.28
                                  }
                                }
                              ]
                            }
                          ]
                          name "R_Ankle_Roll"
                          boundingObject DEF Foot Transform {
                            translation -0.0075 -0.071 0.03
                            children [
                              DEF Foot Shape {
                                geometry Box {
                                  size 0.145 0.008 0.28
                                }
                              }
                            ]
                          }
                          physics DEF Physics_Foot Physics {
			    density -1
                            mass 0.886
                            centerOfMass -0.003 -0.04 0.006  
                          }
                          maxForce 100
                        }
                      ]
                      name "R_Ankle_Pitch"
                      boundingObject Shape {
                        geometry Sphere {
                          radius 0.001
                        }
                      }
                      physics Physics {
                      }
                      maxVelocity 100
                      maxForce 100
                    }
                    DEF Shin Transform {
                      translation 0 -0.175 0
                      children [
                        Shape {
                          geometry Box {
                            size 0.016 0.3 0.063
                          }
                        }
                      ]
                    }
                  ]
                  name "R_Knee_Pitch"
                  boundingObject DEF Shin Transform {
                    translation 0 -0.175 0
                    children [
                      Shape {
                        geometry Box {
                          size 0.016 0.3 0.063
                        }
                      }
                    ]
                  }
                  physics DEF Physics_Shin Physics {
                    density -1
                    mass 0.783
                    centerOfMass -0.001 -0.16 0                   
                  }
                  maxVelocity 100
                  maxForce 100
                }
              ]
              name "R_Hip_Pitch"
              boundingObject DEF Thigh Transform {
                translation 0 -0.175 0
                children [
                  Shape {
                    geometry Box {
                      size 0.016 0.3 0.0535
                    }
                  }
                ]
              }
              physics DEF Physics_Thigh Physics {
                density -1
                mass 1.729
                centerOfMass 0 -0.148 0
                
              }
              maxVelocity 100
              maxForce 100
            }
          ]
          name "R_Hip_Roll"
          boundingObject Shape {
            geometry Sphere {
              radius 0.001
            }
          }
          physics Physics {
          }
          maxVelocity 100
          maxForce 100
        }
      ]
      name "R_Hip_Yaw"
      description "R_Hip_Yaw"
      boundingObject DEF NULLSPHERE Shape {
        geometry Sphere {
          radius 0.001
        }
      }
      physics Physics {
      }
      maxVelocity 100
      maxForce 100
    }
    DEF L_Hip_Yaw Servo {
      translation 0.07 -0.049 -0.0245
      children [
        DEF L_Hip_Roll Servo {
          rotation 0 0 1 0
          children [
            DEF L_Hip_Pitch Servo {
              rotation 1 0 0 0
              children [
                DEF L_Knee_Pitch Servo {
                  translation 0 -0.35 0
                  rotation 1 0 0 0
                  children [
                    DEF L_Ankle_Pitch Servo {
                      translation 0 -0.35 0
                      rotation 1 0 0 0
                      children [
                        DEF L_Ankle_Roll Servo {
                          rotation 0 0 1 0
                          children [
                            DEF L_Foot_Transform Transform {
                              translation 0.0075 -0.071 0.03
                              children [
                                Shape {
                                  geometry Box {
                                    size 0.145 0.0089 0.28
                                  }
                                }
                              ]
                            }
                          ]
                          name "L_Ankle_Roll"
                          boundingObject DEF L_Foot_Transform Transform {
                            translation 0.0075 -0.071 0.03
                            children [
                              Shape {
                                geometry Box {
                                  size 0.145 0.0089 0.28
                                }
                              }
                            ]
                          }
                          physics Physics {
                            density -1
                            mass 0.886
                            centerOfMass 0.003 -0.04 0.006
                         
                          }
                          maxForce 100
                        }
                      ]
                      name "L_Ankle_Pitch"
                      boundingObject DEF NULLSPHERE Shape {
                        geometry Sphere {
                          radius 0.001
                        }
                      }
                      physics Physics {
                      }
                      maxVelocity 100
                      maxForce 100
                    }
                    USE Shin
                  ]
                  name "L_Knee_Pitch"
                  boundingObject USE Shin
                  physics Physics {
                    density -1
                    mass 0.783
                    centerOfMass 0.001 -0.16 0
                    
                  }
                  maxVelocity 100
                  maxForce 100
                }
                USE Thigh
              ]
              name "L_Hip_Pitch"
              boundingObject USE Thigh
              physics DEF Physics_Thigh Physics {
                density -1
                mass 1.729
                centerOfMass 0 -0.148 0
               
              }
              maxVelocity 100
              maxForce 100
            }
          ]
          name "L_Hip_Roll"
          boundingObject USE NULLSPHERE
          physics Physics {
          }
          maxVelocity 100
          maxForce 100
        }
      ]
      name "L_Hip_Yaw"
      boundingObject USE NULLSPHERE
      physics Physics {
      }
      maxVelocity 100
      maxForce 100
    }
    DEF Waist_Roll Servo {
      rotation 0 0 1 0
      children [
#Sensors/recievers added by SJ
	DEF zero GPS {
      name "zero"
    }
       Accelerometer {
     	 translation 0 -0.0684064 -0.01
         rotation 1 0 0 1.5708
         name "accelerometer"
         lookupTable [
           -39.24 0 0
           39.24 1024 0
         ]
       }
       Gyro {
         translation 0 -0.0684064 0.01
         rotation -0.57735 0.57735 0.57735 2.0944
         name "gyro"
         lookupTable [
           -27.925 0 0
           27.925 1024 0
         ]
       }
       DEF RECEIVER Receiver {
        name "receiver"
        channel IS channel
       }
       DEF EMITTER Emitter {
        name "emitter"
        channel IS channel
       }
        DEF SUPER_EMITTER Emitter {
          name "super_emitter"
          channel 2
        }
#End sensors/emitters

#SJ: Darwin-OP head system graft (camera and led too)
	DEF DNeck Servo {
	      translation 0 0.42 0.03
	      rotation 0 1 0 0
	      children [
		DEF DNeckShape Shape {
		  appearance Appearance {
		    material DEF DMetalMaterial Material {
		      diffuseColor 0.7 0.7 0.7
		      specularColor 0.401201 0.401201 0.401201
		    }
		  }
                  geometry Box {
                     size 0.02 0.02 0.02
                  }
		}
		DEF DHead Servo {
	          translation 0 0.02 0 # charli value
		  rotation 1 0 0 0
		  children [
		    #headGroup {}
		    hokuyo{}
		    rgbcam{}
		    DEF DEyeLED LED {
		      rotation 1 0 0 0
		      children [
		        DEF DEyeLEDShape Shape {
		          appearance Appearance {
		            material DEF DLEDMaterial Material {
		              ambientIntensity 0
		              diffuseColor 0.7 0.7 0.7
		            }
		          }
		          geometry IndexedFaceSet {
		            coord Coordinate {
		              point [
		                0.0116412 0.0265999 0.0366955
		                -0.0116412 0.0265999 0.0366955
		                0.0152554 0.0218632 0.0363648
		                -0.0152554 0.0218632 0.0363648
		                0.0201309 0.0187384 0.0349243
		                -0.0201309 0.0187384 0.0349243
		                0.0255253 0.0177015 0.0325931
		                -0.0255253 0.0177015 0.0325931
		                0.0306174 0.0189101 0.0297263
		                -0.0306174 0.0189101 0.0297263
		                0.034632 0.0221804 0.0267603
		                -0.034632 0.0221804 0.0267603
		                0.0369579 0.0270145 0.0241466
		                -0.0369579 0.0270145 0.0241466
		                0.037241 0.0326763 0.0222832
		                -0.037241 0.0326763 0.0222832
		                0.0354382 0.038304 0.0214537
		                -0.0354382 0.038304 0.0214537
		                0.0318239 0.0430408 0.0217844
		                -0.0318239 0.0430408 0.0217844
		                0.0269485 0.0461655 0.023225
		                -0.0269485 0.0461655 0.023225
		                0.0215541 0.0472024 0.0255561
		                -0.0215541 0.0472024 0.0255561
		                0.016462 0.0459938 0.0284229
		                -0.016462 0.0459938 0.0284229
		                0.0124474 0.0427235 0.0313889
		                -0.0124474 0.0427235 0.0313889
		                0.0101215 0.0378894 0.0340026
		                -0.0101215 0.0378894 0.0340026
		                0.0098384 0.0322276 0.035866
		                -0.0098384 0.0322276 0.035866
		                0.0174415 0.0294527 0.0329804
		                -0.0174415 0.0294527 0.0329804
		                0.0192939 0.0270251 0.032811
		                -0.0192939 0.0270251 0.032811
		                0.0217926 0.0254236 0.0320726
		                -0.0217926 0.0254236 0.0320726
		                0.0245573 0.0248921 0.0308779
		                -0.0245573 0.0248921 0.0308779
		                0.0271671 0.0255116 0.0294086
		                -0.0271671 0.0255116 0.0294086
		                0.0292247 0.0271877 0.0278885
		                -0.0292247 0.0271877 0.0278885
		                0.0304167 0.0296652 0.026549
		                -0.0304167 0.0296652 0.026549
		                0.0305618 0.0325669 0.0255939
		                -0.0305618 0.0325669 0.0255939
		                0.0296378 0.0354512 0.0251688
		                -0.0296378 0.0354512 0.0251688
		                0.0277855 0.0378789 0.0253383
		                -0.0277855 0.0378789 0.0253383
		                0.0252868 0.0394803 0.0260766
		                -0.0252868 0.0394803 0.0260766
		                0.022522 0.0400118 0.0272713
		                -0.022522 0.0400118 0.0272713
		                0.0199123 0.0393923 0.0287406
		                -0.0199123 0.0393923 0.0287406
		                0.0178547 0.0377163 0.0302607
		                -0.0178547 0.0377163 0.0302607
		                0.0166627 0.0352387 0.0316003
		                -0.0166627 0.0352387 0.0316003
		                0.0165176 0.032337 0.0325553
		                -0.0165176 0.032337 0.0325553
		              ]
		            }
		            coordIndex [
		              0, 32, 62, -1, 63, 33, 1, -1, 0, 62,
		              30, -1, 31, 63, 1, -1, 0, 2, 34, -1,
		              35, 3, 1, -1, 0, 34, 32, -1, 33, 35,
		              1, -1, 2, 4, 36, -1, 37, 5, 3, -1,
		              2, 36, 34, -1, 35, 37, 3, -1, 6, 8,
		              40, -1, 41, 9, 7, -1, 6, 40, 38, -1,
		              39, 41, 7, -1, 8, 10, 42, -1, 43, 11,
		              9, -1, 8, 42, 40, -1, 41, 43, 9, -1,
		              10, 12, 44, -1, 45, 13, 11, -1, 10, 44,
		              42, -1, 43, 45, 11, -1, 14, 16, 48, -1,
		              49, 17, 15, -1, 14, 48, 46, -1, 47, 49,
		              15, -1, 16, 18, 50, -1, 51, 19, 17, -1,
		              16, 50, 48, -1, 49, 51, 17, -1, 18, 20,
		              52, -1, 53, 21, 19, -1, 18, 52, 50, -1,
		              51, 53, 19, -1, 22, 24, 56, -1, 57, 25,
		              23, -1, 22, 56, 54, -1, 55, 57, 23, -1,
		              24, 26, 58, -1, 59, 27, 25, -1, 24, 58,
		              56, -1, 57, 59, 25, -1, 26, 28, 60, -1,
		              61, 29, 27, -1, 26, 60, 58, -1, 59, 61,
		              27, -1, 28, 30, 62, -1, 63, 31, 29, -1,
		              28, 62, 60, -1, 61, 63, 29, -1, 4, 6,
		              38, -1, 39, 7, 5, -1, 4, 38, 36, -1,
		              37, 39, 5, -1, 12, 14, 46, -1, 47, 15,
		              13, -1, 12, 46, 44, -1, 45, 47, 13, -1,
		              20, 22, 54, -1, 55, 23, 21, -1, 20, 54,
		              52, -1, 53, 55, 21, -1
		            ]
		            creaseAngle 0.2
		          }
		        }
		      ]
		      name "EyeLed"
		      color [
		      ]
		      gradual TRUE
		    }
		    DEF DHeadLED LED {
		      rotation 1 0 0 0
		      children [
		        DEF DHeadLEDShape Shape {
		          appearance Appearance {
		            material USE DLEDMaterial
		          }
		          geometry IndexedFaceSet {
		            coord Coordinate {
		              point [
		                0 0.0488546 0.0285779
		                0 0.057406 0.0180599
		                0.0070464 0.0573781 0.01728
		                -0.0070464 0.0573781 0.01728
		                0.0083894 0.0559858 0.019199
		                -0.0083894 0.0559858 0.019199
		                0.008978 0.0540208 0.0218855
		                -0.008978 0.0540208 0.0218855
		                0.0049843 0.051013 0.0258813
		                -0.0049843 0.051013 0.0258813
		              ]
		            }
		            coordIndex [
		              0, 8, 1, -1, 9, 0, 1, -1, 1, 8,
		              6, -1, 7, 9, 1, -1, 1, 6, 4, -1,
		              5, 7, 1, -1, 1, 4, 2, -1, 3, 5,
		              1, -1
		            ]
		            creaseAngle 0.2
		          }
		        }
		      ]
		      name "HeadLed"
		      color [
		      ]
		      gradual TRUE
		    }
		  ]
		  name "Neck"
		  boundingObject Transform {
		    translation 0 0.022 -0.012
		    rotation 1 0 0 1.5708
		    children [
		      Capsule {
		        height 0.018
		        radius 0.042
		      }
		    ]
		  }
		  physics Physics {
		    density -1
		    mass 0.158042
		    centerOfMass 6.39198e-05 0.0185645 0.00766662
		  }
		  maxForce 2.35
		}
	      ]
	      name "Head"
	      boundingObject Transform {
		translation 0 -0.009 0
		children [
		  Box {
                     size 0.02 0.02 0.02
                  }		  
		]
	      }
	      physics Physics {
		density -1
		mass 0.0243577
		centerOfMass 0.00142428 -0.0165676 -0.000712811
	      }
	      maxForce 2.35
	    }


#End OP head

        DEF R_Shoulder_Pitch Servo {
          translation -0.187 0.334 0
          rotation 1 0 0 0
          children [
            DEF R_Shoulder_Roll Servo {
              rotation 0 0 1 0
              children [
                DEF R_Shoulder_Yaw Servo {
                  children [
                    DEF R_Elbow Servo {
                      translation 0 -0.15 0
                      rotation 1 0 0 0
                      name "R_Elbow"
#added lower arm by SJ
	              children [
	                Transform {
                          translation 0 -0.1475 0
                          children [
                            Shape {
  	                      appearance Appearance {
                   	        material USE DMetalMaterial
  		              }
                              geometry Box {
                                size 0.045 0.222 0.04
                              }
			    }
                          ]
                         }
			]
			boundingObject DEF LowerArm Transform {
	                    translation 0 -0.1475 0
	                    children [
         	             Shape {
                 	       geometry Box {
            	       	         size 0.045 0.222 0.04
	                       }
                             }
	                    ]
                  	}
#end lower arm
                        physics Physics {
                        density -1
                        mass 0.411
                        centerOfMass -0.009 -0.119 0
                        inertiaMatrix [
                          0.002315, 0.002329, 0.000125, 2e-06, 1.4e-05, -0.000112
                        ]
                      }
                      maxVelocity 100
                      maxForce 10000
                    }
                    DEF UpperArm Transform {
                      translation 0 -0.0925 0
                      children [
                        Shape {
                          geometry Box {
                            size 0.045 0.112 0.04
                          }
                        }
                      ]
                    }
                  ]
                  name "R_Shoulder_Yaw"
                  boundingObject DEF UpperArm Transform {
                    translation 0 -0.0925 0
                    children [
                      Shape {
                        geometry Box {
                          size 0.045 0.112 0.04
                        }
                      }
                    ]
                  }
                  physics Physics {
                    density -1
                    mass 0.372
                    centerOfMass 0.004 -0.024 0
                    inertiaMatrix [
                      0.000725, 0.000726, 0.000184, 7e-06, 6.3e-05, 2.7e-05
                    ]
                  }
                  maxVelocity 100
                  maxForce 10000
                }
              ]
              name "R_Shoulder_Roll"
              boundingObject USE NULLSPHERE
              physics Physics {
              }
              maxVelocity 100
              maxForce 10000
            }
          ]
          name "R_Shoulder_Pitch"
          boundingObject USE NULLSPHERE
          physics Physics {
          }
          maxVelocity 100
          maxForce 10000
          controlP 100
        }
        DEF L_Shoulder_Pitch Servo {
          translation 0.187 0.334 0
          rotation -1 0 0 0
          children [
            DEF L_Shoulder_Roll Servo {
              rotation 0 0 -1 0
              children [
                DEF L_Shoulder_Yaw Servo {
                  children [
                    DEF L_Elbow Servo {
                      translation 0 -0.15 0
                      rotation -1 0 0 0
                      name "L_Elbow"
#added lower arm by SJ
	              children [
	                Transform {
                          translation 0 -0.1475 0
                          children [
                            Shape {
  	                      appearance Appearance {
                   	        material USE DMetalMaterial
  		              }
                              geometry Box {
                                size 0.045 0.222 0.04
                              }
			    }
                          ]
                         }
			]
		        boundingObject DEF LowerArm Transform {
	                    translation 0 -0.1475 0
	                    children [
         	             Shape {
                 	       geometry Box {
            	       	         size 0.045 0.222 0.04
	                       }
                             }
	                    ]
                  	}

#end lower arm

                      physics Physics {
                        density -1
                        mass 0.411
                        centerOfMass 0.009 -0.119 0
                        inertiaMatrix [#copied from r_elbow.. may not be correct
                          0.002315, 0.002329, 0.000125, 2e-06, 1.4e-05, -0.000112
                        ]
                      }
                      maxVelocity 100
                      maxForce 10000
                    }
                    USE UpperArm
                  ]
                  name "L_Shoulder_Yaw"
                  boundingObject USE UpperArm
                  physics Physics {
                    density -1
                    mass 0.372
                    centerOfMass -0.004 -0.024 0
                    inertiaMatrix [
                      0.000725, 0.000726, 0.000184, 7e-06, 6.3e-05, 2.7e-05
                    ]
                  }
                  maxVelocity 100
                  maxForce 10000
                }
              ]
              name "L_Shoulder_Roll"
              boundingObject USE NULLSPHERE
              physics Physics {
              }
              maxVelocity 100
              maxForce 10000
            }
          ]
          name "L_Shoulder_Pitch"
          boundingObject USE NULLSPHERE
          physics Physics {
          }
          maxVelocity 100
          maxForce 10000
        }
        DEF Torso Group {
          children [
            Transform {
              translation 0 0.15 0
              children [
                Shape {
                  geometry Box {
                    size 0.048 0.2 0.046
                  }
                }
              ]
            }
            Transform {
              translation 0 0.296 0
              children [
                Shape {
                  geometry Box {
                    size 0.221 0.19 0.133
                  }
                }
              ]
            }
          ]
        }
      ]
      name "Waist_Roll"
      boundingObject DEF Torso Group {
        children [
          Transform {
            translation 0 0.15 0
            children [
              Shape {
                geometry Box {
                  size 0.048 0.2 0.046
                }
              }
            ]
          }
          Transform {
            translation 0 0.296 0
            children [
              Shape {
                geometry Box {
                  size 0.221 0.19 0.133
                }
              }
            ]
          }
        ]
      }
      physics Physics {
        density -1
        mass 1.766
        centerOfMass 0 0.248 0
        inertiaMatrix [
          0.020987, 0.018093, 0.005271, -0.000189, 0.000973, 0.000194
        ]
      }
      maxVelocity 100
      maxForce 10000
    }
  ]
  name "CHARLI"
  boundingObject DEF HipGroup Group {
    children [
      Shape {
        geometry Box {
          size 0.186 0.022 0.069
        }
      }
    ]
  }
  physics Physics {
    density -1
    mass 1.798
    centerOfMass 0 0.023 -0.028
    inertiaMatrix [
      0.010981, 0.010432, 0.016582, -7e-05, 0.001978, 5.4e-05
    ]
  }
  controller "void"
}
}
