<!DOCTYPE html>
<html>
  <head>
    <style>
      #container {
        background: #000;
        width: 640px;
        height: 480px;
      }
      #kinect {
        background: #ccc;
        width: 320px;
        height: 240px;
      }
    </style>
  </head>

  <!--
  <canvas id="kinect">
  </canvas>
  -->
  <div id="container">
  </div>

  <script src="http://zeptojs.com/zepto.min.js"></script>
  <script src="http://mrdoob.github.com/three.js/build/three.min.js"></script>
  <script src="http://mrdoob.github.com/three.js/examples/js/controls/TrackballControls.js"></script>
  <script src="http://mrdoob.github.com/three.js/examples/js/Detector.js"></script>
  <script src="http://mrdoob.github.com/three.js/examples/js/libs/stats.min.js"></script>

  <script>
    var host = window.document.location.host.replace(/:.*/, '');
  </script>

  <!--Receiving Depth Image-->
  <script src="kinect_gl.js"></script>
  <script>
    var xyz;
    console.log('Connecting to '+host+' 8080')
    var ws = new WebSocket('ws://' + host + ':8080');
    ws.binaryType = "arraybuffer";
    ws.onmessage = function (event) {
      xyz = new Uint8Array( event.data );
      update_particles( xyz );
//      console.log( depth );
    };
  </script>

  <!--Receiving LIDAR-->
  <!--
  <script src="lidar_gl.js"></script>
  <script>
    console.log('Connecting to '+host+' 9000')
    var ws = new WebSocket('ws://' + host + ':9000');
    var ranges;
    ws.binaryType = "arraybuffer";
    ws.onmessage = function (event) {
      ranges = new Float32Array( event.data );
      update_particles( ranges );
      //console.log( event.data );
    };
  </script>
  -->

  <!--Receiving an image-->
  <!--
  <script src="kinect_gl.js"></script>
  <script>
    console.log('Connecting to '+host+' 8080')
    var ws_i = new WebSocket('ws://' + host + ':8080');
    ws_i.binaryType = "blob";
    var jpeg_url_name = "";
    var img = new Image;
    var myCanvas = document.getElementById('kinect');
    var ctx = myCanvas.getContext('2d');
    ws_i.onmessage = function (event) {
      // Revoke the previous
      window.URL.revokeObjectURL(jpeg_url_name);
      var parts = []
      parts.push(event.data)
      var tmp = new Blob( parts, { "type" : "image\/jpeg" } )
      var jpeg_url_name = (window.URL || window.webkitURL).createObjectURL(tmp)
      img.src = jpeg_url_name;
      img.onload = function(){
        ctx.drawImage( img, 0, 0 ); // Or at whatever offset you like
        var imgdata = ctx.getImageData(0, 0, 320, 190);
        update_kinect( new Uint8Array(imgdata.data.buffer ) );
        //console.log( imgdata );
      };
    };
  </script>
  -->

</html>
